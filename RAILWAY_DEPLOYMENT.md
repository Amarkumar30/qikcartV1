# FreshSip Juice Bar - Railway Deployment Guide

This guide provides step-by-step instructions to deploy the FreshSip Juice Bar application on Railway.

## Prerequisites

1. A Railway account (sign up at https://railway.app)
2. GitHub account with the project repository
3. Razorpay account for payment processing
4. Basic understanding of Railway dashboard

## Deployment Steps

### Step 1: Prepare Your Repository

1. Ensure your code is pushed to a GitHub repository
2. Verify that all necessary files are committed:
   - `package.json`
   - `pnpm-lock.yaml`
   - `Dockerfile`
   - `drizzle/` directory with migrations
   - `server/` and `client/` directories

### Step 2: Create Railway Project

1. Log in to Railway dashboard
2. Click "New Project"
3. Select "Deploy from GitHub"
4. Connect your GitHub account and select the FreshSip repository
5. Railway will automatically detect the Dockerfile and start building

### Step 3: Configure Services

Railway will create the following services:

#### Database Service (MySQL)

1. Click "Add Service" → "MySQL"
2. Railway will automatically create a MySQL database
3. The connection string will be available as `DATABASE_URL`

#### Application Service

The application service is automatically created from the Dockerfile.

### Step 4: Set Environment Variables

In the Railway dashboard, go to your project and add the following environment variables:

**Required Variables:**
```
JWT_SECRET=your-secret-key-here-change-in-production
RAZORPAY_KEY_ID=rzp_live_your_key_id
RAZORPAY_KEY_SECRET=rzp_live_your_key_secret
VITE_RAZORPAY_KEY_ID=rzp_live_your_key_id
NODE_ENV=production
PORT=3000
```

**Optional Variables:**
```
LOG_LEVEL=info
ALLOWED_ORIGINS=https://yourdomain.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

The following variables are automatically provided by Railway:
- `DATABASE_URL` - MySQL connection string

### Step 5: Configure Custom Domain (Optional)

1. In Railway dashboard, go to your application service
2. Click "Settings"
3. Under "Domains", click "Generate Domain" or add a custom domain
4. Update your application's CORS settings if using a custom domain

### Step 6: Deploy

1. Railway automatically deploys when you push to the main branch
2. Monitor the deployment in the Railway dashboard
3. Check logs for any errors

### Step 7: Initialize Database

After first deployment:

1. SSH into the Railway container or use Railway CLI
2. Run database migrations:
   ```bash
   pnpm db:push
   ```
3. (Optional) Seed initial menu items if needed

## Environment Variables Explanation

### Payment Gateway (Razorpay)
- `RAZORPAY_KEY_ID`: Your Razorpay API Key ID (from dashboard)
- `RAZORPAY_KEY_SECRET`: Your Razorpay API Key Secret (keep this secret!)
- `VITE_RAZORPAY_KEY_ID`: Public key for frontend (same as KEY_ID)

### Database
- `DATABASE_URL`: MySQL connection string (auto-generated by Railway)

### Security
- `JWT_SECRET`: Secret key for session tokens (generate a strong random string)
- `ALLOWED_ORIGINS`: Comma-separated list of allowed domains

### Application
- `NODE_ENV`: Set to "production" for Railway
- `PORT`: Application port (default 3000)
- `LOG_LEVEL`: Logging level (info, debug, error)

## Monitoring and Maintenance

### View Logs
1. In Railway dashboard, select your application service
2. Click "Logs" tab to view real-time logs

### Database Backups
Railway automatically backs up your MySQL database. Check the Railway documentation for backup policies.

### Scaling
1. In Railway dashboard, go to your application service
2. Click "Settings" → "Scale"
3. Adjust resources as needed

## Troubleshooting

### Application won't start
1. Check logs in Railway dashboard
2. Verify all environment variables are set correctly
3. Ensure database connection string is valid

### Payment gateway errors
1. Verify Razorpay credentials are correct
2. Check that you're using the correct key type (test vs live)
3. Ensure CORS settings allow Razorpay domain

### Database connection issues
1. Verify DATABASE_URL is correct
2. Check that MySQL service is running
3. Run migrations: `pnpm db:push`

### Static assets not loading
1. Verify assets are in `client/public/` directory
2. Check that Vite build completed successfully
3. Verify CORS headers are set correctly

## Updating the Application

To update your application:

1. Make changes locally
2. Commit and push to GitHub
3. Railway automatically deploys the new version
4. Monitor logs for successful deployment

## Rollback

If deployment fails:

1. In Railway dashboard, go to your application service
2. Click "Deployments" tab
3. Select a previous successful deployment
4. Click "Redeploy"

## Support

For Railway-specific issues, visit: https://docs.railway.app

For FreshSip application issues, contact: support@freshsip.com

## Additional Resources

- Railway Documentation: https://docs.railway.app
- Razorpay Integration: https://razorpay.com/docs/
- MySQL Documentation: https://dev.mysql.com/doc/
